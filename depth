#include <murAPI.hpp>
 int DEBUG = 1;

//установка глубины в см

float errorOld=0,error=0,errorIntegral=0;
//коэфф.пропорциональности для поддержки глубины
int kpdepth = 15;
int kddepth = 15;
int kidepth = 0.1;
int filtre[3];
//таймер работы программы
Timer t;
float getdepth()
{
    filtre[2]=filtre[1];
    filtre[1]=filtre[0];
    float filtre[0]=mur.getInputAOne(); //датчик глубины на первом i2c
    //float dep=mur.getInputBOne(); //датчик глубины на втором i2c
    return (filtre[3]+filtre[1]+filtre[2])/3;
}
void setdepth(float depthToSet){
    float depth = getdepth();
    error=depthToSet-depth;
    errorIntegral+=error;
    mur.setPortC((depthToSet-depth)*kpdepth+(error-errorOld)*kddepth+errorIntegral*kidepth);
errorOld=error;
    if(errorIntegral>3000){
        errorIntegral=3000;}
 if(errorIntegral>-3000){
        errorIntegral=-3000;}
        //  if (DEBUG) 
        //вывод сообщения про err глубины каждые 5 сек
        
    
   // std::cout << "err depth " << depthToSet - depth << std::endl;
}

int main()
{
    
    
    while(true){
        setdepth(50);
        //mur.setPortC(-100);//+ down
        
        }
    return 0;
}
